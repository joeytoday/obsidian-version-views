# Version View

一个 Obsidian 插件，用于保存、管理和查看文件的不同版本，支持版本对比和恢复。

## 功能特性

- **版本保存**：一键保存当前文件的版本快照
- **版本管理**：查看所有历史版本，支持编辑版本名称和描述
- **版本对比**：并排对比任意版本与当前文件的差异（绿色=新增，红色=删除）
- **版本恢复**：一键将文件恢复到任意历史版本
- **自动编号**：版本自动编号（V1, V2, V3...），最早的是 V1，最新的是 VN

## 安装

### 手动安装

1. 下载 `main.js`、`styles.css`、`manifest.json`
2. 复制到你的 Vault 文件夹 `.obsidian/plugins/version-view/`
3. 重启 Obsidian
4. 在 **设置 → 社区插件** 中启用 Version View

## 使用方法

### 打开版本视图

- 点击左侧边栏的 **历史图标** 🕐
- 或使用命令面板：`Version View: 打开版本视图`

### 保存版本

1. 打开版本视图
2. 在顶部输入框中输入**版本名称**（可选）
3. 点击 **保存此版本** 按钮
4. 新版本会显示在版本列表顶部

> 💡 如果不输入版本名称，将只显示版本号（如 V1、V2）

### 版本列表

版本列表按时间倒序排列，最新的版本在最上方：

```
【V5】版本名称      [🔍][✏️][↩️][🗑️]
【V4】             [🔍][✏️][↩️][🗑️]
【V3】重要修改      [🔍][✏️][↩️][🗑️]
【V2】             [🔍][✏️][↩️][🗑️]
【V1】初始版本      [🔍][✏️][↩️][🗑️]
```

按钮说明：
- 🔍 **查看差异**：对比该版本与当前文件的差异
- ✏️ **编辑**：修改版本名称和描述
- ↩️ **恢复**：将文件恢复到该版本
- 🗑️ **删除**：删除该版本

### 版本对比

点击 🔍 按钮打开对比视图：

- **左侧**：选中的历史版本（标题显示 `V3-版本名称`）
- **右侧**：当前文件内容（标题显示 `当前版本`）
- **绿色背景**：新增的内容
- **红色背景**：删除的内容
- **Frontmatter**：自动压缩行间距显示

点击外部区域或按 `ESC` 关闭对比窗口。

### 恢复版本

点击 ↩️ 按钮，确认后将文件内容恢复到该版本。

### 编辑版本信息

点击 ✏️ 按钮，可以修改：
- **版本名称**：如 "初稿"、"重要修改"、"最终版" 等
- **版本描述**：详细说明该版本的变更内容

## 设置

进入 **设置 → 社区插件 → Version View** 进行配置：

| 设置项 | 默认值 | 说明 |
|--------|--------|------|
| 版本存储文件夹 | `res/versions` | 版本文件存储的根目录路径 |
| 最大版本数量 | 50 | 每个文件保留的最大版本数量 |
| 自动保存版本 | 关闭 | 打开文件时自动保存一个版本 |

### 存储结构

版本文件存储在 `{storageFolder}/{filename}/` 目录下：

```
vault/
└── res/
    └── versions/
        └── file/              # 以文件名（不含扩展名）为文件夹名
            ├── versions.json       # 版本索引文件
            ├── version_xxx_1.md    # 版本内容文件
            └── version_xxx_2.md    # 版本内容文件
```

## 快捷键

在命令面板中可以找到以下命令：

- `Version View: 打开版本视图` - 打开版本管理侧边栏
- `Version View: 保存当前文件版本` - 快速保存当前文件的版本

你可以为这些命令绑定快捷键：

1. 进入 **设置 → 快捷键**
2. 搜索 "Version View"
3. 为对应命令添加快捷键

## 常见问题

**Q: 保存版本会占用多少空间？**  
A: 每个版本保存一份完整的文件副本，建议根据需要设置合理的最大版本数量。

**Q: 删除版本后还能恢复吗？**  
A: 不能，删除操作是永久性的，请谨慎操作。

**Q: 可以导出版本吗？**  
A: 目前不支持直接导出，版本文件存储在 `res/versions/{filename}/` 目录下，可以直接访问。

## 开发

```bash
# 安装依赖
npm install

# 开发模式（监听文件变化自动编译）
npm run dev

# 构建生产版本
npm run build
```

## License

[MIT](LICENSE)
